---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import type { PageDefinition } from "../../../data/navigation";
import { newsreleasePages } from "../../../data/navigation";
import { getEntry } from "astro:content";

export function getStaticPaths() {
    const paths: any[] = [];
    ["jp", "en", "zh"].forEach((lang) => {
        newsreleasePages.forEach((page) => {
            paths.push({
                params: { lang, slug: page.slug },
                props: { page },
            });
        });
    });

    return paths;
}

const { lang, slug } = Astro.params;
const { page } = Astro.props as { page: PageDefinition };

const translations = {
    jp: { section: "発表資料" },
    en: { section: "News Release" },
    zh: { section: "发布资料" },
};

const t = translations[lang as keyof typeof translations] || translations.jp;
const pageTitle = page.title[lang as keyof typeof page.title] || page.title.jp;

// Fetch content from collection
const entry = await getEntry("newsrelease", `${lang}/${slug}`);
const { Content } = entry ? await entry.render() : { Content: null };
---

<BaseLayout
    title={`${entry?.data.title || pageTitle} | Lantern-TECH Blog`}
    description={entry?.data.description}
    ogImage={entry?.data.ogImage}
    lang={lang}
>
    <header class="page-header">
        <span class="category">{t.section}</span>
        <h1>{entry?.data.title || pageTitle}</h1>
    </header>

    <article class="content">
        {
            Content ? (
                <Content />
            ) : (
                <p>
                    Generating content for {slug} ({lang})...
                </p>
            )
        }
    </article>
</BaseLayout>

<style>
    .page-header {
        margin-bottom: 2rem;
        border-bottom: 1px solid #eee;
        padding-bottom: 1rem;
    }

    .category {
        font-size: 0.9rem;
        color: var(--color-accent);
        text-transform: uppercase;
        font-weight: bold;
    }

    h1 {
        margin-top: 0.5rem;
        font-size: 2rem;
    }

    .content {
        line-height: 1.8;
    }

    /* Section-based Layout Styles */
    :global(.content-section) {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        margin-bottom: 2rem;
        width: 100%;
    }

    :global(.text-column) {
        width: 100%;
    }

    :global(.image-column) {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    :global(.image-wrapper img) {
        width: 100%;
        height: auto;
        border-radius: 4px; /* Optional polish */
        display: block;
    }

    /* Content spacing */
    :global(.text-column > *) {
        margin-bottom: 1rem;
    }

    /* Desktop Layout */
    @media (min-width: 768px) {
        :global(.content-section) {
            flex-direction: row;
            align-items: flex-start; /* Align to top */
            gap: 2rem;
        }

        :global(.text-column) {
            flex: 2; /* Takes 2/3 roughly */
            min-width: 0; /* Prevent flex overflow */
        }

        :global(.image-column) {
            flex: 1; /* Takes 1/3 roughly */
            position: sticky;
            top: 2rem; /* Stick to top while scrolling past long text */
        }
    }
</style>
