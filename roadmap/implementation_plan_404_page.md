# 404ページ多言語対応計画

## 目標
404ページのデザインを更新し、画像セクションのタイトルを「Atelier de 404」に変更、手書き風フォントを適用します。
また、その下の説明文も多言語対応し、言語に応じた適切なフォントで表示します。
**[NEW]** 表示されるランダム画像を、ユーザーのブラウザ言語（表示中の404ページの言語）と一致する言語のページから選出するように変更します。
**[NEW]** GIF画像（お​​よびローカル画像）がリンク切れになる問題を修正します。

## 変更内容

### [MODIFY] [src/layouts/BaseLayout.astro](file:///Users/ofuchirin/code/lantern-tech-blog/astroprojects/src/layouts/BaseLayout.astro)
- `<head>`内に `<slot name="head" />` を追加し、各ページから`head`タグ内に追加要素（フォントリンク等）を注入できるようにする。（完了済み）

### [MODIFY] [src/pages/404.astro](file:///Users/ofuchirin/code/lantern-tech-blog/astroprojects/src/pages/404.astro)
- **サーバーサイド処理**:
    - 全画像を収集後、言語（`jp` -> `ja`, `zh`, `en`）ごとにグループ化する。
    - 各言語ごとに候補リストを作成し、JSON形式でクライアントに渡す準備をする。
        - ペイロード削減のため、各言語最大20〜50件程度に絞る（シャッフルして抽出）。
    - **[FIX] 相対パス画像の除外**:
        - プロトコル（`http://`, `https://`）で始まらない画像リンク（ローカルの相対パス等）は、404ページでは正しく解決できないため除外する。
        - これにより、意図せずローカルGIF等が選ばれてリンク切れになるのを防ぐ。
- **クライアントサイド処理 (`<script>`)**:
    - `groupData` (言語ごとの画像リスト) を受け取る。
    - 決定された言語 (`lang`) に対応するリストからランダムに1枚選出する。
    - 選出された画像データでDOM (`img.src`, `a.href`, `article-title` 等) を更新する。

## データ構造のマッピング
- ディレクトリ名 `jp` -> クライアント言語コード `ja`
- ディレクトリ名 `zh` -> クライアント言語コード `zh`
- ディレクトリ名 `en` -> クライアント言語コード `en`

## 検証計画
1. 開発サーバー (`npm run dev`) を起動。
2. 相対パスで記述された画像が含まれる記事がある場合、それが404ページで選ばれないことを確認（または選ばれても除外されていること）。
3. 外部（Imgur等）のGIF/画像は引き続き表示されることを確認。
